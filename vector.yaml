sources:
  stdin:
    type: "stdin"

transforms:
  logs_inner_json_unwrapped:
    inputs:
      - "stdin"
    type: "remap"
    source: |
      ., _ = parse_json(.message)

sinks:
  out:
    inputs:
      - "logs_inner_json_unwrapped"
    type: "console"
    encoding:
      codec: "logfmt"

  loki:
    type: loki
    inputs:
      - "logs_inner_json_unwrapped"
    endpoint: "${LOKI}"
    encoding:
      codec: "json"
    labels:
      app: "vpod"
